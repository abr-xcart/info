<html>
<head>
<title>tools</title>
</head>
<body>
http://www.host.com:2086/scripts/command?PFILE=Service_Configuration
Service Configuration -> Apache Configuration -> Include Editor -> Pre VirtualHost Include -> All Versions -> pre_virtualhost_global.conf

<pre>
dir="var log files catalog templates_c .pgp skin* images"
find $dir -exec chmod a+w "{}" \;

cd .git
chmod -R ug+rw,o-rwx .
find . -type d -exec chmod g+s "{}" \;

wget http://support.x-dev.us/support.php


wget -Ophpinfo.php http://info.x-dev.us/phpinfo
wget -O`ls -1d /var/www/vhosts/*/httpdocs/`phpinfo.php http://info.x-dev.us/phpinfo

wget -O/etc/profile.d/abr.sh http://info.x-dev.us/abr.sh
wget -Oxcheck.php  http://info.x-dev.us/xcheck/xcheck.php
wget -Omod_install.php http://info.x-dev.us/mod_install/mod_install.php
wget -Oftp.php http://info.x-dev.us/ftp/ftp.php
wget -Oatar.php http://info.x-dev.us/atar/atar.php

wget http://www.day32.com/MySQL/tuning-primer.sh
wget https://raw.githubusercontent.com/rackerhacker/MySQLTuner-perl/master/mysqltuner.pl

mkdir ~/.ssh 2>&1 && wget -O ~/.ssh/authorized_keys ~/.ssh/authorized_keys http://info.x-dev.us/authorized_keys 2>&1 && chmod -R go-rwx ~/.ssh

</pre>
<h1>Patches</h1>
http://help.x-cart.com/images/1/1a/MYSQL5_comp_for_4.0.x.txt
<pre>
SET @src = "/home/content/d/i/n/dinoshop/html/";
SET @dst = "/var/www/vhosts/trextoys.com/httpdocs/";

SELECT image_path, REPLACE(image_path,@src,@dst) FROM xcart_images_T WHERE image_path LIKE "/%" LIMIT 10;

UPDATE xcart_images SET image_path = REPLACE(image_path,@src,@dst) WHERE image_path LIKE "/%";
UPDATE xcart_icons SET image_path = REPLACE(image_path,@src,@dst) WHERE image_path LIKE "/%";
UPDATE xcart_thumbnails SET image_path = REPLACE(image_path,@src,@dst) WHERE image_path LIKE "/%";

UPDATE xcart_images_T SET image_path = REPLACE(image_path,@src,@dst) WHERE image_path LIKE "http://%";


UPDATE xcart_config SET value = REPLACE( value,@src,@dst) WHERE name IN ('icons_path','thumbnails_path','det_images_path');
==== SHOP CLOSED
SET @shop_closed = ( SELECT IF( value = "Y", "N", "Y") as val FROM xcart_config WHERE name = "shop_closed" );                 
UPDATE xcart_config SET value = @shop_closed WHERE name = 'shop_closed';                                                      
SELECT value FROM xcart_config WHERE name = "shop_closed";                                                                    
</pre>
<h1>VIM</h1>
<pre>
:set wrap
:e ++ff=unix
:%s/\r//g

:s@^--- xcart/\([^\t]\+\)\t@Index: \1\r\0@g                                                                                   
:,/^Index:/-1d                                                                                                                
</pre>
<h1>SQL PARSER</h1>
<pre>
:s/\(SELECT\|FROM\|INNER JOIN\|LEFT JOIN\|GROUP BY\|WHERE\|JOIN\|ORDER BY\|HAVING\|LIMIT\) /\r\1 \r\t/gi
:s/\(SELECT\( DISTINCT\)\?\|FROM\|INNER JOIN\|LEFT JOIN\|GROUP BY\|WHERE\|JOIN\|ORDER BY\|HAVING\|LIMIT\) /\r\1 \r\t/gi
</pre>
<h1>GREP</h1>
<pre>
# colorize
alias grep='grep --color=auto'

sudo update-alternatives --config editor

export EDITOR=`which vim`
export VISUAL=$EDITOR
export LS_OPTIONS='--color=auto'
# Colours in less
export LESS='-R'

export EXCLUDES=$(for e in so bin exe dll cur cpp pl orig lst ico jpeg JPG jpg png tif gif iso flv wmv swf MPG mpg mp3 zip tar rar gz tgz bz2 pdf sql; do echo -n " --exclude=\*.$e "; done)
alias grep="grep --color=auto $EXCLUDES"
printf ":g/qt_debug/d\n:x\n" | ex FILE

# === grep XCart PHP files ===
pcregrep -l --color -r --exclude_dir='(?:log|upgrade|cache|tmp|templates_c)' --include='\.php$' <PATTERN> <PATH>
</pre>

<h1>CVS</h1>
<pre>
export CVSROOT=:ext:cvs@cvs.x-dev.us:/home/cvs/WORK/PRIVATE/src/CVS
export CVS_RSH=ssh
alias cvsd='cvs diff -u | colordiff | less -R'

If getting sticky tag for file "is not a branch" error when trying to do cvs ci,
Just run cvs update -A on these files to revert your working copy to the head revisions.
</pre>

<h1>GIT</h1>
<pre>
# Initialize X-Cart repo
wget -O.gitignore http://info.x-dev.us/gitignore.xcart

git ci -m INIT --allow-empty
git add .gitignore
git ci -m GIT
git add customer/ admin/ provider/ payment/ modules/ mail/ shipping/ include/ catalog/ sql/ var/ install*.php INSTALL*
git add *.php

# Setup Client Env Vars for Git
cat << EOL >> $HOME/.ssh/config
Host *
SendEnv GIT_AUTHOR_NAME
SendEnv GIT_AUTHOR_EMAIL
EOL

cat << EOL >> $HOME/.bashrc
export GIT_AUTHOR_NAME="Yuriy Abramov"
export GIT_AUTHOR_EMAIL="abr@x-cart.com"
EOL

# Setup Server Env Vars for Git
echo "AcceptEnv GIT_AUTHOR_NAME GIT_AUTHOR_EMAIL" >> /etc/ssh/sshd_config
service sshd reload

# General Git config
git config --global user.name "X-Cart Hosting Admin"
git config --global user.email `whoami`@`hostname`
git config --global color.ui true
git config --global color.status always
git config --global color.diff always
git config --global diff.tool vimdiff
git config --global difftool.prompt false
git config --global difftool.vimdiff.cmd 'vim -f -d -c "wincmd l" -c '\''cd "$GIT_PREFIX"'\'' "$LOCAL" "$REMOTE"'
git config --global mergetool.prompt false
git config --global merge.tool vimdiff
git config --global alias.d difftool
git config --global alias.co checkout
git config --global alias.ci commit
git config --global alias.b branch
git config --global alias.m mergetool
git config --global core.pager 'less -R'
</pre>
<pre>
visudo
Defaults    env_keep += SSH_AUTH_SOCK
</pre>
<h1>gnupg.vim</h1>
<pre>
mkdir -p $HOME/.vim/plugin
export GPG_TTY=`tty`
wget -O $HOME/.vim/plugin/gnupg.vim "http://www.vim.org/scripts/download_script.php?src_id=12200"
</pre>

https://support.cloudflare.com/hc/en-us/articles/200169166-How-do-I-whitelist-CloudFlare-s-IP-addresses-in-iptables-

service iptables-persistent save
aptitude install ipset iptables-persistent
export SET=qtm
ipset create $SET hash:net
for x in $(curl http://info.x-dev.us/qtmsoft-ips.txt); do ipset add $SET $x; done
iptables -A INPUT -m set --match-set $SET src -p tcp -m multiport --dports 1022 -j ACCEPT
service iptables-persistent save

</body>
</html>
